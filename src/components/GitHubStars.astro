---
interface Props {
	repo: string; // format: "owner/repo"
	class?: string;
}

const { repo, class: className } = Astro.props;

let stars = null;
let error = null;

try {
	const response = await fetch(`https://api.github.com/repos/${repo}`, {
		headers: process.env.GITHUB_TOKEN ? { Authorization: `Bearer ${process.env.GITHUB_TOKEN}` } : {},
	});
	if (response.ok) {
		const data = await response.json();
		stars = data.stargazers_count;
	} else {
		error = `Failed to fetch stars: ${response.status}`;
	}
} catch (e) {
	error = `Failed to fetch GitHub stars: ${e}`;
}
---

{stars !== null && (
	<a
		href={`https://github.com/${repo}`}
		rel="noopener noreferrer"
		target="_blank"
		class:list={["github-stars", className]}
		title="View on GitHub"
	>
		<svg class="star-icon" viewBox="0 0 16 16" fill="currentColor">
			<path d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.147.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.714 1.955a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.146-.611L7.327.668A.75.75 0 018 .25z" />
		</svg>
		<span class="stars-count">{stars.toLocaleString()}</span>
	</a>
)}

<style>
	.github-stars {
		display: inline-flex;
		align-items: center;
		gap: 0.375rem;
		color: var(--sl-color-text-accent);
		text-decoration: none;
		font-size: var(--font-size-small);
		font-weight: 500;
		transition: all 0.2s ease;
		white-space: nowrap;
	}

	.github-stars:hover {
		opacity: 0.7;
	}

	.star-icon {
		width: 1rem;
		height: 1rem;
		flex-shrink: 0;
	}

	.stars-count {
		display: inline-block;
	}

	@media (max-width: 768px) {
		.github-stars {
			font-size: 0.65rem;
			gap: 0.25rem;
		}

		.star-icon {
			width: 0.9rem;
			height: 0.9rem;
		}

		.stars-count {
			display: none;
		}
	}

	@media (min-width: 769px) and (max-width: 1023px) {
		.github-stars {
			font-size: 0.7rem;
			gap: 0.3rem;
		}

		.star-icon {
			width: 0.95rem;
			height: 0.95rem;
		}
	}
</style>
