---
title: Monitoring & Health Checks
description: Monitor bot status and health
---

## Health Check Endpoint

The bot provides a monitoring endpoint on the configured port.

```bash
curl http://your-bot:8080/healthcheck
```

### Response

**Healthy (200 OK):**
```json
{
  "status": "ok",
  "version": "3.4.1",
  "commit": "abc123",
  "buildDate": "2024-11-10"
}
```

**Error (500 Error):**
```json
{
  "status": "error",
  "message": "database connection failed"
}
```

## What Gets Checked

1. **Database** - PostgreSQL connectivity
2. **Remnawave Panel** - API availability
3. **Bot Service** - Process running
4. **API Key** - Credentials valid

## Monitoring Setup

### Docker Compose Health Check

Already configured in `docker-compose.yaml`:

```yaml
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:8080/healthcheck"]
  interval: 30s
  timeout: 10s
  retries: 3
```

### Manual Monitoring

Check status regularly:

```bash
# Check now
curl -s http://localhost:8080/healthcheck | jq

# Check every minute
watch -n 60 'curl -s http://localhost:8080/healthcheck | jq'

# Log results
while true; do
  echo "$(date): $(curl -s http://localhost:8080/healthcheck)"
  sleep 60
done >> /var/log/bot-health.log
```

### External Monitoring

**Uptime Robot** (recommended):
1. Go to [uptimerobot.com](https://uptimerobot.com)
2. Add HTTP monitor
3. URL: `https://bot.example.com/healthcheck`
4. Interval: 5 minutes
5. Get alerts on failures

**Grafana + Prometheus**:
- Scrape endpoint every 30s
- Create dashboards
- Set up alerts

## Logs & Debugging

### View Logs

```bash
# Current logs
docker compose logs remnawave-telegram-shop-bot

# Follow logs (live)
docker compose logs -f remnawave-telegram-shop-bot

# Last N lines
docker compose logs --tail 100 remnawave-telegram-shop-bot

# Specific time range
docker compose logs --since 2024-11-10T10:00:00 --until 2024-11-10T11:00:00 remnawave-telegram-shop-bot
```

### Database Logs

```bash
docker compose logs -f postgres
```

### Filter Logs

```bash
# Errors only
docker compose logs remnawave-telegram-shop-bot | grep ERROR

# Payment related
docker compose logs remnawave-telegram-shop-bot | grep -i payment

# Specific user
docker compose logs remnawave-telegram-shop-bot | grep "user_id:123456789"
```

## Key Metrics to Monitor

| Metric | Healthy | Warning | Critical |
|--------|---------|---------|----------|
| Response Time | under 100ms | 100-500ms | over 500ms |
| Error Rate | under 1% | 1-5% | over 5% |
| CPU Usage | under 50% | 50-80% | over 80% |
| Memory | under 500MB | 500-1GB | over 1GB |
| DB Connections | under 10 | 10-20 | over 20 |

## Performance Tuning

### Optimize Database

```sql
-- Check slow queries
EXPLAIN ANALYZE SELECT * FROM subscriptions WHERE user_id = 123;

-- Create indexes if needed
CREATE INDEX idx_subscriptions_user_id ON subscriptions(user_id);

-- Check bloat
SELECT * FROM pg_stat_user_tables WHERE n_dead_tup > 1000;
```

### Scale Bot

- Multiple instances behind load balancer
- Database replication
- Cache layer (Redis)
- CDN for static content

## Alert Setup

### Email Alerts

```bash
# In crontab
*/5 * * * * /usr/local/bin/check-bot-health.sh

#!/bin/bash
if ! curl -s http://localhost:8080/healthcheck | grep -q "ok"; then
  echo "Bot is down!" | mail -s "Alert: Bot Down" admin@example.com
fi
```

### Telegram Notifications

```bash
# Send alert to admin
curl -X POST https://api.telegram.org/bot<TOKEN>/sendMessage \
  -d "chat_id=<ADMIN_ID>" \
  -d "text=Bot health check failed"
```

## Troubleshooting Unhealthy Bot

1. **Check Process**
   ```bash
   docker compose ps
   docker compose logs -f
   ```

2. **Check Database**
   ```bash
   docker compose exec postgres psql -U remnawave -d remnawave -c "SELECT 1"
   ```

3. **Check Remnawave**
   ```bash
   curl https://your-panel.com/health
   ```

4. **Restart If Needed**
   ```bash
   docker compose restart remnawave-telegram-shop-bot
   ```

5. **Full Restart**
   ```bash
   docker compose down
   docker compose up -d
   docker compose logs -f
   ```

## Maintenance Windows

Plan maintenance during low-traffic hours:
- 2-4 AM local time
- Update Docker images
- Run database maintenance
- Backup data
- Test restore procedures
